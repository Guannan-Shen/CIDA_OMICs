---
title: "HW8"
author: "Guannan Shen"
date: "November 19, 2018"
output: 
  pdf_document:
    latex_engine: lualatex
    number_sections: yes
    toc: yes
    toc_depth: 5
  word_document:
    toc: yes
    toc_depth: '5'
  html_document:
    number_sections: yes
    theme: united
    toc: yes
    toc_depth: 5
    toc_float: yes
---

```{r setup, include=FALSE, cache = FALSE}
require("knitr")
opts_chunk$set(tidy.opts=list(width.cutoff=60),tidy=TRUE)
opts_chunk$set(engine = "R")
knitr::opts_chunk$set(echo = T)
knitr::opts_chunk$set(message = F)
knitr::opts_chunk$set(warning = F)
## setting wd in DELL
## opts_knit$set(root.dir = "~/Stats/CIDA_OMICs/CIDA_OMICS/7659Stats_Genetics/HW5/")
## setting working directory in asus 
## opts_knit$set(root.dir = "C:/Users/hithr/Documents/Stats/CIDA_OMICs/7659Stats_Genetics/HW5/") 
## setting working directory in ubuntu
opts_knit$set(root.dir = "~/Documents/Stats/CIDA_OMICs/7659Stats_Genetics/HW8/")
                                                 
## cache = F, if cache = T, will not revaluate code chunk everytime
## double or more space to insert a line break
```


```{r libs}
## set up workspace
library(knitr)
library(tidyverse)
library(magrittr)
library(FlowSorted.Blood.450k)
library(quadprog)
library(minfi)
library(IlluminaHumanMethylation450kmanifest)
options(stringsAsFactors = F)
options(dplyr.width = Inf)
getwd()
## not in function
'%nin%' <- Negate('%in%')

# ######## clean memory ######################
# rm(list = ls())
# gc()

```

# 1. Cell Type Composition
Background on data set: The occurrence of gestational diabetes mellitus (GDM) during pregnancy is believed to alter obesity risk of offspring later in life. It was hypothesized that exposure to maternal GDM in utero will be associated with changes in DNA methylation patterns of key genes and pathways in the offspring, which will mediate the association between in utero exposure and childhood adiposity-related outcomes. Data was collected from the EPOCH (Exploring Perinatal Outcomes in CHildren) study, a historical prospective cohort that enrolled children aged 10.5 on average (T1) who were exposed or not exposed to maternal GDM during the intrauterine life. DNA was extracted from peripheral blood samples collected from children at the T1 EPOCH visit on 85 exposed to GDM and 85 unexposed to GDM, and methylation data was generated using the Illumina Infinium HumanMethylation450 BeadChip. We have provided data on a subset of 10 subjects (all Non-Hispanic Whites) from these two groups to identify methylation sites and nearby genes that show differential methylation between the two groups. The data for this problem is available through a link on Canvas to the "blood" folder on Dropbox.

## (a) Use SWAN normalization from Homework 7, then find differentially methylated positions based on exposure status using dmpFinder(). Are there any DMPs with q-value <= 0.10 (or p-value cutoff of 10-5)? Summarize the results in a table and include the direction (hyper or hypo methylated based on exposure status).

```{r SWANDMPS}
## import data 
## under directory 
## ~/Documents/Stats/CIDA_OMICs/7659Stats_Genetics/HW8/
baseDir1 <- "blood/plate1"
targets1 <- read.metharray.sheet(baseDir1)
baseDir2 <- "blood/plate2"
targets2 <- read.metharray.sheet(baseDir2)
targets <- rbind(targets1, targets2)

rgSet <- read.metharray.exp(targets=targets, extended=T)
#for part c), use "extended =F"

# clinical and groups
sampleNames(rgSet) = rgSet[[1]]
getManifest(rgSet)
clindat <- read.table("blood/demographic.txt", sep="\t", header=T)
pData(rgSet)$Sample_Group <- clindat$Exposure
pData(rgSet)$child_sex <- clindat$child_sex


```









